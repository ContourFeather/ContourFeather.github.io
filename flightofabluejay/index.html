<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Flight of a Blue Jay</title>
        <style>
            canvas{
                border: 6px solid black;
            }
        </style>
    </head>
    <body>
        <h1>Flight of a Blue Jay</h1>
        <span>Beta Test 1.0.0.</span>
        
        <h2>Controls</h2>
        <ul>
            <li>Click mouse to jump, click while jumping to fly</li>
            <li>Use the cursor to choose flight direction</li>
            <li>Press "e" while on a food source to eat it</li>
            <li>Press "c" while on a food source to carry the food, you can only carry one piece of food at a time</li>
            <li>Press "c" again to cache it</li>
            <li>Press "f" to locate your nest and food caches</li>
            <li>Press "t" to speed up time</li>
            <li>Press "s" to go to the title screen</li>
        </ul>

        <h2>Explanations</h2>
        <ul>
            <li>This game simulates the life of a blue jay during the winter.</li>
            <li>
                Blue jays "scatter hoard", meaning that they will cache food in many different places.
                In this game, you can place two caches too close to each other to represent this.</li>
            <li>
                Blue jays can actually carry three pieces of food but for simplicity, they only carry one piece in this game.
                That piece of food represents multiple pieces of food.
                Blue jays have great memory but they may sometimes forget where they hid a cache.  Also, other animals may find and steal your food.
            </li>
            <li>When a hawk appears it will circle overhead.  It will not attack unless it sees you.  To reduce chances of detection, hide in your nest, a bush, or perch on a branch.  DO NOT FLY.</li>
            <li>You win by scoring points.  You gain points from how much food you have scattered and how many hawks you have escaped.</li>
            <li>You lose if your health, energy, or hunger bar is drained.</li>
            <li>Your hunger and energy bars will automatically deplete.  They will deplete faster in colder weather.</li>
            <li>Your energy bar will deplete much faster when it is night, so be sure not to stay up too late.  Your energy also depletes faster the more energy you have lost.</li>
        </ul>


        <script src="./music.js"></script>
        <script src="./hud.js"></script>
        <script src="./generateTEMP.js"></script>
        <script src="./getimages.js"></script>
        <script src="./character.js"></script>
        <script src="./worldgen.js"></script>
        <script src="./hawks.js"></script>
        <script src="./objects.js"></script>
        <script src="./p5 copy.js"></script>
        <script>
            let width = 1200, height = 600, FPS, TAU = 2*Math.PI;
            function sign(x){
                let s = 0;
                if(x > 0){
                    s = 1;
                } else if(x < 0){
                    s = -1;
                }
                return s;
            }
            function linearDist(x1, x2, includeSign, loop){
                if(includeSign === undefined){
                    return abs(x1-x2);
                } else{
                    return x1-x2;
                }
            }
            function withinRange(v, r1, r2){
                if(v >= r1 && v <= r2){
                    return true;
                }
                return false;
            }

            function monteCarlo(mi=0, ma=1, advantage=true){ // min value, max value, range favored
                let r1 = random(mi, ma),
                r2 = random(mi, ma)
                if(advantage){
                    while(r1 < r2){
                        r1 = random(mi, ma);
                        r2 = random(mi, ma);
                    }
                } else{
                    while(r1 > r2){
                        r1 = random(mi, ma);
                        r2 = random(mi, ma);
                    }
                }
                return r1;
            }

            let toCartesian = function(r, theta){
                let x = r * cos(theta);
                let y = r * sin(theta);
                return createVector(x, y);
            };

            let toPolar = function(x, y){
                let theta = atan(y/x);
                let radius = y / sin(theta);
                return createVector(radius, theta);
            }

            function button(x, y, w, h, c){
                if(mouseIsPressed && mouseX > x && mouseX < x + w && mouseY > y && mouseY < y + h){
                    c();
                }
            }

            let wait = function(duration, callback){
                this.duration = duration;
                this.callback = callback;
                this.counter = 0;
                this.completed = false;
                this.loop = loop;
            }
            wait.prototype.run = function(){
                if(this.counter > this.duration){
                    this.callback();
                    this.completed = true;
                }
                this.counter++;
            };

            let delays = [];

            const keys = [];
            const onKeyPress = [];

            onKeyPress.push(function(){
                if(!jay.gameOver && key === "s"){
                    jay.gamePlaying = false;
                }
            })

            function runDelays(){
                for(var i = 0; i < delays.length; i++){
                    delays[i].run();
                    if(delays[i].completed && !delays[i].loop){
                        delays.splice(i, 1);
                    }
                }
            };

            function setup(){
                let ctx = createCanvas(width, height);
                getMusic();
                getImages();
                generateWorld();
                createCharacter();
                createHawks();
                placeObjects();
                loadHUD();
                imageMode(CENTER);      
                
                world.draw(); // gives homescreen background
            }
            
            

            function draw(){
                if(jay.gamePlaying && !jay.gameOverTransisionDone){ // play game
                    FPS = frameRate();

                    world.countTime();
                    world.findDarkness();
                    world.draw();
                    world.setTemperature();

                    jay.hop();
                    jay.fly();
                    jay.move();
                    jay.land();
                    if(!jay.inNest){ // if the jay is in the nest we are already drawing them
                        jay.draw();
                    }
                    jay.find();

                    jay.updateStats();
                    jay.manageFoodCaches();
                    jay.calcVictoryPoints();
                    jay.controlDisplayPoint();

                    world.spawnHawks();
                    runHawks();

                    runDelays();

                    if(jay.gamePlaying){
                        displayHUD();
                    }

                    world.skipNight();

                    jay.endGame();

                    nextSoundTrack();

                    if(mouseIsPressed){
                        if(jay.flying){
                            jay.tryingToLand = true;
                        }
                    } else{
                        jay.tryingToLand = false;
                    }
                    
                    for(var i = 0; i < keys.length; i++){
                        if(keys[i] === "t"){
                            for(var j = 0; j < 5; j++){
                                world.time++;
                                world.findSkyColor();
                                world.findDarkness();
                                jay.updateStats();
                                jay.move();
                                if(!jay.isPerched){
                                    jay.draw();
                                }
                                world.spawnHawks();
                                runHawks();
                            }
                        }
                    }
                } else if(!jay.gamePlaying){
                    fill(255);
                    noStroke();
                    textSize(100);
                    text("Flight of a Blue Jay", 200, 100);
                    textSize(30);
                    text("Click to start", 250, 150);
                    stroke(0);
                    textSize(12);
                }
            }
            function mousePressed(){
                if(jay.gamePlaying && !jay.gameOverTransisionDone){
                    if(jay.hopping){
                        jay.onDoubleClick()
                    }
                    if(jay.isPerched){
                        jay.isPerched = false;
                        jay.inNest = false;
                        jay.airborne = true;
                        if(jay.inNest){
                            jay.onDoubleClick();
                        }
                    }
                } else{
                    jay.gamePlaying = true;
                    if(jay.gameOverTransisionDone){
                        jay.reset();
                    }
                }
            }

            function keyTyped(){
                keys.push(key);
                for(var i = 0; i < onKeyPress.length; i++){
                    onKeyPress[i]();
                }
            }
            function keyReleased(){
                for(var i = 0; i < keys.length; i++){
                    if(key.toLowerCase() === keys[i].toLowerCase()){
                        keys.splice(i, 1);
                    }
                }
            }
        </script>


        
        <!--
            Actually cite these!

            
            https://sora.unm.edu/sites/default/files/journals/condor/v076n03/p0358-p0360.pdf
            https://nationalzoo.si.edu/animals/news/how-do-birds-handle-heat
            https://www.audubon.org/field-guide/bird/blue-jay
            https://www.flockingaround.com/post/how-long-can-birds-survive-without-food
            https://www.w3schools.com/js/js_array_sort.asp
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-noise/a/two-dimensional-noise
            https://p5js.org/reference/#/p5/frameRate
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-vectors/a/interactive-vector-motion
            https://p5js.org/reference/#/p5.Element/doubleClicked
            https://p5js.org/reference/#/p5.Vector
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-noise/a/perlin-noise

            https://www.w3schools.com/tags/ref_av_dom.asp
            https://www.w3schools.com/js/js_scope.asp

            https://p5js.org/reference/#/p5/push
            https://p5js.org/reference/#/p5/rotate
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-angular-movement/a/polar-coordinates
            https://www.w3schools.com/tags/av_prop_volume.asp
            https://www.w3schools.com/tags/ref_av_dom.asp
        -->
    </body>
</html>