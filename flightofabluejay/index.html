<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Flight of a Blue Jay</title>
        <style>
            canvas{
                border: 6px solid black;
            }
        </style>
    </head>
    <body>
        <h3>Alpha test 1.0</h3>
        <p>
            Click mouse to jump, click while jumping to fly.
            Use the cursor to determine direction.
            Press "e" to eat a food source.
            Press "c" when on a food source to carry the food.
            Press "c" again to place down a food cache.
            Press "t" to speed up time.
        </p>

        <script src="./music.js"></script>
        <script src="./hud.js"></script>
        <script src="./getimages.js"></script>
        <script src="./character.js"></script>
        <script src="./worldgen.js"></script>
        <script src="./objects.js"></script>
        <script src="./p5 copy.js"></script>
        <script>
            let width = 1200, height = 600, FPS, TAU = 2*Math.PI;
            function sign(x){
                let s = 0;
                if(x > 0){
                    s = 1;
                } else if(x < 0){
                    s = -1;
                }
                return s;
            }
            function linearDist(x1, x2, includeSign, loop){
                if(includeSign === undefined){
                    return abs(x1-x2);
                } else{
                    return x1-x2;
                }
            }
            function withinRange(v, r1, r2){
                if(v >= r1 && v <= r2){
                    return true;
                }
                return false;
            }

            function monteCarlo(mi=0, ma=1, advantage=true){ // min value, max value, range favored
                let r1 = random(mi, ma),
                r2 = random(mi, ma)
                if(advantage){
                    while(r1 < r2){
                        r1 = random(mi, ma);
                        r2 = random(mi, ma);
                    }
                } else{
                    while(r1 > r2){
                        r1 = random(mi, ma);
                        r2 = random(mi, ma);
                    }
                }
                return r1;
            }

            let toCartesian = function(r, theta){
                let x = r * cos(theta);
                let y = r * sin(theta);
                return createVector(x, y);
            };

            let toPolar = function(x, y){
                let theta = atan(y/x);
                let radius = y / sin(theta);
                return createVector(radius, theta);
            }

            let wait = function(duration, callback){
                this.duration = duration;
                this.callback = callback;
                this.counter = 0;
                this.completed = false;
                this.loop = loop;
            }
            wait.prototype.run = function(){
                if(this.counter > this.duration){
                    this.callback();
                    this.completed = true;
                }
                this.counter++;
            };

            let delays = [];

            const keys = [];
            const onKeyPress = [];

            function runDelays(){
                for(var i = 0; i < delays.length; i++){
                    delays[i].run();
                    if(delays[i].completed && !delays[i].loop){
                        delays.splice(i, 1);
                    }
                }
            };

            function setup(){
                let ctx = createCanvas(width, height);
                getMusic();
                getImages();
                generateWorld();
                createCharacter();
                placeObjects();
                loadHUD();
                imageMode(CENTER);                
            }
            

            function draw(){
                FPS = frameRate();

                world.countTime();
                world.draw();
                world.setTemperature();

                jay.hop();
                jay.fly();
                jay.move();
                jay.land();
                jay.draw();
                jay.updateStats();
                jay.manageFoodCaches();
                jay.controlDisplayPoint();
                runDelays();
                displayHUD();
                nextSoundTrack();

                if(mouseIsPressed){
                    if(jay.flying){
                        jay.tryingToLand = true;
                    }
                } else{
                    jay.tryingToLand = false;
                }
                
                for(var i = 0; i < keys.length; i++){
                    if(keys[i] === "t"){
                        world.time+=2;
                        world.findSkyColor();
                        world.findSkyColor();
                    }
                }
            }
            function mousePressed(){
                if(jay.hopping){
                    jay.onDoubleClick()
                }
                if(jay.isPerched){
                    jay.isPerched = false;
                    jay.inNest = false;
                    jay.airborne = true;
                    if(jay.inNest){
                        jay.onDoubleClick();
                    }
                }
            }

            function keyTyped(){
                keys.push(key);
                for(var i = 0; i < onKeyPress.length; i++){
                    onKeyPress[i]();
                }
            }
            function keyReleased(){
                for(var i = 0; i < keys.length; i++){
                    if(key.toLowerCase() === keys[i].toLowerCase()){
                        keys.splice(i, 1);
                    }
                }
            }
        </script>

        <!--
            Actually cite these!
            https://www.audubon.org/field-guide/bird/blue-jay
            https://www.flockingaround.com/post/how-long-can-birds-survive-without-food
            https://www.w3schools.com/js/js_array_sort.asp
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-noise/a/two-dimensional-noise
            https://p5js.org/reference/#/p5/frameRate
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-vectors/a/interactive-vector-motion
            https://p5js.org/reference/#/p5.Element/doubleClicked
            https://p5js.org/reference/#/p5.Vector
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-noise/a/perlin-noise

            https://www.w3schools.com/tags/ref_av_dom.asp
            https://www.w3schools.com/js/js_scope.asp

            https://p5js.org/reference/#/p5/push
            https://p5js.org/reference/#/p5/rotate
            https://www.khanacademy.org/computing/computer-programming/programming-natural-simulations/programming-angular-movement/a/polar-coordinates
        -->
    </body>
</html>
